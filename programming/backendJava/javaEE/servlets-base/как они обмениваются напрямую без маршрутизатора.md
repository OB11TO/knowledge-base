---
title: как они обмениваются напрямую без маршрутизатора
tags:
  - Network
related_topics: 
created: 2024-09-13 17:22
modified: 2024-09-13T17:23:03+03:00
questions: 
notes: 
links: 
---
Когда два устройства обмениваются данными напрямую в одной сети (например, через Wi-Fi), это называется **одноранговое взаимодействие** (или **P2P**, peer-to-peer), и происходит оно на канальном уровне OSI (уровень 2). При этом используются **MAC-адреса**, а IP-адреса и сетевая маска служат для идентификации устройств в одной локальной сети. Вот как это работает:

### Компоненты взаимодействия

1. **Wi-Fi** — это технология на физическом и канальном уровнях модели OSI. Она обеспечивает беспроводную связь между устройствами. Wi-Fi работает как средство для передачи данных внутри одной сети.
    
2. **Точка доступа (Access Point)** — это устройство (или маршрутизатор), которое управляет передачей данных между беспроводными устройствами. Хотя точка доступа подключена к маршрутизатору, она работает на канальном уровне, организуя связь между устройствами.
    
3. **MAC-адрес** — это уникальный физический адрес каждого сетевого устройства. Он используется для адресации пакетов внутри локальной сети.
    
4. **IP-адрес и сетевая маска** — используются на сетевом уровне (уровень 3 OSI) для адресации и маршрутизации данных. В локальной сети они помогают устройствам идентифицировать друг друга и определять, можно ли отправить данные напрямую или нужно обращаться к маршрутизатору.
    

### Процесс обмена данными напрямую через Wi-Fi

1. **Устройства подключены к одной точке доступа**: Два устройства, например, ноутбук и смартфон, подключены к одной точке доступа Wi-Fi (например, к домашнему роутеру).
    
2. **Определение сетевого уровня (IP-адрес и маска подсети)**: Оба устройства получают IP-адреса и маску подсети от DHCP-сервера, который обычно встроен в Wi-Fi маршрутизатор. Сетевая маска помогает определить, находятся ли устройства в одной подсети.
    
3. **Отправка данных на канальном уровне**:
    
    - Когда одно устройство хочет отправить данные другому в той же сети, оно использует **IP-адрес** получателя, чтобы понять, к какой сети принадлежит устройство (с помощью сетевой маски).
    - Если отправитель и получатель находятся в одной сети, отправитель отправляет **ARP-запрос** (Address Resolution Protocol), чтобы узнать **MAC-адрес** получателя по его IP-адресу.
    - Получив MAC-адрес, отправитель может передать данные напрямую на канальном уровне (через Wi-Fi), используя MAC-адрес получателя.
4. **Передача через точку доступа**:
    
    - Данные передаются через точку доступа (Wi-Fi роутер), но маршрутизация на уровне 3 (IP) не используется. Точка доступа просто пересылает данные от одного устройства к другому внутри локальной сети на уровне 2 (Ethernet, Wi-Fi).
    - Точка доступа смотрит только на MAC-адреса и решает, куда переслать данные, не вмешиваясь в IP-адресацию.

### Пример передачи данных

1. **Ноутбук** с IP-адресом 192.168.1.10 хочет отправить данные на **смартфон** с IP-адресом 192.168.1.20.
2. Ноутбук проверяет, находятся ли оба устройства в одной подсети (с помощью сетевой маски 255.255.255.0). Он видит, что 192.168.1.10 и 192.168.1.20 принадлежат одной сети (192.168.1.0).
3. Ноутбук отправляет ARP-запрос, чтобы узнать MAC-адрес смартфона.
4. Смартфон отвечает с его MAC-адресом.
5. Ноутбук отправляет данные, адресуя их по MAC-адресу смартфона.
6. Точка доступа Wi-Fi получает данные и перенаправляет их на смартфон.

### Прямое P2P взаимодействие (Ad-hoc сети)

В некоторых случаях устройства могут общаться напрямую **без точки доступа**. Это называется **Ad-hoc сетью** (или одноранговой сетью). В такой сети устройства создают временное соединение друг с другом, обмениваясь данными напрямую без маршрутизатора или точки доступа. Ad-hoc сети также работают на канальном уровне с использованием MAC-адресов.

### Заключение

При передаче данных внутри одной сети Wi-Fi, маршрутизатор не участвует в маршрутизации трафика. Устройства обмениваются данными через точку доступа, которая работает на уровне 2 OSI (канальный уровень), используя **MAC-адреса** для доставки пакетов. **IP-адрес и сетевая маска** помогают определить, что устройства находятся в одной сети и могут передавать данные напрямую.