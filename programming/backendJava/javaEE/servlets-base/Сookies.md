---
title: Сookies
tags:
  - JavaEE
related_topics: 
created: 2024-09-11 13:58
modified: 2024-09-13T18:38:16+03:00
questions: 
notes: 
links: 
---

### Сookies

![[Untitled 50.png]]

```Java
import jakarta.servlet.ServletException;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.util.Arrays;
import java.util.concurrent.atomic.AtomicInteger;

public class CookieServlet extends HttpServlet {
    private static final String UNIQUE_ID = "user_id";
    private final AtomicInteger counter = new AtomicInteger();

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        var cookies = req.getCookies();
        if(cookies == null  || Arrays.stream(cookies)
                .filter(cookie -> UNIQUE_ID.equals(cookie.getName()))
                .findFirst()
                .isEmpty()){
            var cookie = new Cookie(UNIQUE_ID, "1");
            cookie.setPath("/cookies");
            cookie.setMaxAge(15*60);
            resp.addCookie(cookie);
            counter.incrementAndGet();
        }
        resp.setContentType("text/html");
        try(var writer = resp.getWriter()){
            writer.write(counter.get());
        }
    }
}
```

![[Untitled 51.png]]

**Cookies** — это <mark class="hltr-yellow">небольшие фрагменты данных, которые веб-сервер отправляет на клиентский браузер, а затем этот браузер отправляет их обратно на сервер с каждым последующим запросом</mark>. <mark class="hltr-red">Они часто используются для сохранения информации о состоянии и предпочтениях пользователя.
</mark>
### Основные аспекты Cookies:

1. **Что такое Cookie?**
    
    - Cookie — это <mark class="hltr-yellow">текстовый файл, который создается веб-сервером и сохраняется на компьютере пользователя</mark>. Этот файл <mark class="hltr-purple">содержит данные, такие как идентификатор сессии, настройки пользователя, или любые другие данные, которые сервер может использовать для персонализации взаимодействия с пользователем.</mark>
2. **Для чего нужны Cookies?**
    
    - **Сохранение состояния**: Cookies <mark class="hltr-green2">позволяют сохранять состояние между запросами</mark>. Например, <mark class="hltr-yellow">если пользователь вошел в систему, сервер может сохранить информацию о входе в виде cookie, чтобы не запрашивать повторно логин при каждом запросе.</mark>
    - **Персонализация**: Cookies<mark class="hltr-yellow"> могут хранить пользовательские предпочтения и настройки</mark>, такие как язык интерфейса или тематика сайта.
    - **Аналитика и отслеживание**: Cookies <mark class="hltr-yellow">используются для сбора данных о том, как пользователи взаимодействуют с сайтом</mark>, что помогает улучшить пользовательский опыт и проводить анализ.
    - **Аутентификация**: <mark class="hltr-yellow">Cookies могут хранить токены аутентификации, которые используются для проверки идентификации пользователя на сервер</mark>е.
3. **Аналог Cookies:**
    
    - **Local Storage и Session Storage**: Это API браузера, которые также позволяют сохранять данные на клиентской стороне,<mark class="hltr-red"> но в отличие от cookies, данные не отправляются на сервер с каждым запросом.</mark>
    - **IndexedDB**: Это база данных, встроенная в браузер, которая позволяет хранить большие объемы структурированных данных.
    - **Web SQL**: Поддерживает хранение данных в SQL базе данных в браузере, но сейчас считается устаревшим стандартом.
4. **Связь с сессией:**
    
    - Cookies часто <mark class="hltr-yellow">используются для хранения идентификатора сессии.</mark> При создании сессии сервер может отправить cookie с уникальным идентификатором, который браузер будет отправлять обратно на сервер с каждым запросом. Это позволяет серверу идентифицировать пользователя и поддерживать состояние между запросами.
5. **JWT и Cookies:**
    
    - **JWT (JSON Web Token)**: Это стандарт для создания токенов, которые могут содержать информацию о пользователе и его правах.<mark class="hltr-yellow"> JWT могут быть сохранены в cookies, но также могут быть использованы в локальном хранилище</mark>. Е<mark class="hltr-red">сли JWT хранится в cookie, его нужно защищать, например, с помощью флага</mark> `HttpOnly` и `Secure`, <mark class="hltr-purple">чтобы предотвратить доступ к нему из JavaScript и защитить его от подделки.</mark>
6. **Аутентификация и Cookies:**
    
    - <mark class="hltr-red">Cookies часто используются для аутентификации, так как они могут хранить идентификатор сессии или токен аутентификации</mark>. Когда пользователь логинится, сервер может создать cookie с токеном или идентификатором, который будет использоваться для проверки пользователя в последующих запросах.

### Реальные кейсы применения Cookies:

1. **Управление сессиями**:
    
    - Пример: Веб-сайты используют cookies для хранения идентификатора сессии, чтобы отслеживать пользователя в течение всего сеанса работы с сайтом, что позволяет сохранять состояние входа в систему.
2. **Персонализация интерфейса**:
    
    - Пример: Если сайт позволяет пользователю выбирать тему или язык, эти предпочтения могут быть сохранены в cookies, чтобы при следующем посещении пользователь не нужно было снова настраивать эти параметры.
3. **Аналитика и отслеживание**:
    
    - Пример: Cookies могут использоваться для отслеживания активности пользователя на сайте (например, страницы, которые он посещает), что помогает улучшить пользовательский опыт и проводить маркетинговые исследования.
4. **Реклама**:
    
    - Пример: Cookies могут использоваться для хранения информации о предпочтениях пользователей и таргетированной рекламы, чтобы показывать рекламу, соответствующую интересам пользователя.
5. **Безопасность**:
    
    - Пример: Cookies могут содержать информацию о том, был ли выполнен вход, а также данные для защиты от CSRF (Cross-Site Request Forgery), если используются специальные флаги и настройки безопасности.

Cookies играют важную роль в современных веб-приложениях, предоставляя механизм для хранения и передачи данных между клиентом и сервером. Правильное использование и конфигурация cookies могут значительно улучшить пользовательский опыт и безопасность веб-приложений.



>[!OFF-TOPIK] **OAuth 2.0**:

- Более популярная версия протокола OAuth. Она определяет несколько потоков (например, авторизационный код, имплицитный, ресурсный сервер) для получения токенов доступа в зависимости от типа приложения и сценария использования.

**Различия от Cookies:**

1. **Цель использования**:
    
    - **Cookies**: Хранят данные на стороне клиента, помогают поддерживать состояние и аутентификацию в рамках одного веб-приложения.
    - **OAuth**: Протокол авторизации для предоставления доступа к ресурсам на другом сервисе без раскрытия учетных данных пользователя.
2. **Механизм работы**:
    
    - **Cookies**: Простая система хранения данных и аутентификации, где данные отправляются на сервер с каждым запросом.
    - **OAuth**: Сложный процесс авторизации, который включает в себя взаимодействие между пользователем, авторизационным сервером и ресурсным сервером для получения и использования токенов доступа.
3. **Безопасность**:
    
    - **Cookies**: Может быть подвержен различным атакам (XSS, CSRF), требует дополнительной настройки безопасности.
    - **OAuth**: Спроектирован с учетом безопасности и предоставляет механизмы для безопасной передачи токенов и ограничения доступа.
4. **Применение**:
    
    - **Cookies**: Широко используется в веб-приложениях для хранения сессионных данных, пользовательских предпочтений и т.д.
    - **OAuth**: Применяется для авторизации и доступа к ресурсам, особенно в сценариях, где требуется взаимодействие между разными сервисами и приложениями.

**Пример использования OAuth:**

- Вы хотите войти на сайт с помощью своей учетной записи Google. Вы перенаправляетесь на страницу авторизации Google, где предоставляете разрешение. Google выдает токен, который используется для доступа к вашему профилю и другой информации на сайте.

Таким образом, Cookies и OAuth решают разные задачи: cookies управляют состоянием и аутентификацией в рамках одного приложения, тогда как OAuth обеспечивает безопасную авторизацию и доступ к ресурсам между разными сервисами.