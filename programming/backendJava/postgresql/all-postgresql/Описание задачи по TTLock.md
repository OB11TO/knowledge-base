---
modified: 2024-11-28T13:34:44+03:00
---

# Задачи по реализации системы управления умными замками с использованием шлюза
#### **Общий обзор**

Система предназначена для управления BLE-замками через шлюз и облачный сервер, с возможностью администрирования через веб-интерфейс.

1. **Оборудования для начала работы:**
    -  **Замки TTLock** (например, модель _TTLock Renty Black_ ), поддерживающие через управление BLE.
    - **Wi-Fi шлюзы** (например, _TTLock Gateway G2_ ), для организации удаленного доступа через интернет.
2. **Анализ документации TTLock API** :
    - Изучить доступный API TTLock.
    - Определить, какие методы взаимодействия применяются через облачный сервис TTLock, в частности для шлюза.

---
#### **Компоненты системы**

1. **Замки TTLock Renty Black**:
    - Используют BLE для локального управления.
    - Могут быть связаны с сервером через шлюз.
2. **Wi-Fi шлюз**:
    - Адаптер для связи замков с сервером.
    - Два варианта:
        1. **Готовый шлюз TTLock Gateway**  (если поддерживает REST API).
        2. **Собственный шлюз на Raspberry Pi**. (например)
3. **Облачный сервер**:
    - Реализован на Java Spring Boot.
    - Предоставляет REST API для администрирования и управления замками, пользователями и логами.
4. **База данных PostgreSQL**:
    - Для хранения данных о замках, пользователях и логах событий.
5. **Веб-интерфейс**:
    - Административная панель для управления системой.

### Архитектура системы управления умными замками

Вся логика управления замками и пользователями сосредоточена на облачном сервере (Java-приложении). Приложение обеспечивает взаимодействие с замками двумя возможными способами: через **TTLock Gateway** или через собственное приложение на **Raspberry Pi**, работающей как BLE-транслятор.

---
### Функционал сервера (Java-приложение)
Сервер является основным центром управления и выполняет следующие задачи:
#### 1. **Авторизация и управление пользователями**
- **Регистрация пользователей**: Создание учетных записей.
- **Авторизация**: Вход в систему через логин и пароль.
- **Роли**:
    - **Администратор**: Управление замками, шлюзами и пользователями.
    - **Пользователь**: Доступ к определенным замкам или группам замков (например, только открытие/закрытие).
#### 2. **Управление замками**
- Регистрация новых замков в системе.
- Удаление или обновление информации о замках.
- Группировка замков по зонам или объектам.
- Назначение прав доступа к замкам (персонально или для группы).
#### 3. **Операции с замками**
- Открытие и закрытие замков через REST-запросы.
- Проверка состояния замков (открыт/закрыт, заряд батареи).
- Генерация временных и постоянных ключей доступа.
- Отображение журнала операций (все действия с замками: кто, когда, какое действие).
#### 4. **Работа с группами замков**
- Объединение замков в группы (например, по этажам, зонам доступа).
- Назначение прав доступа на уровне группы.
#### 5. **Интеграция с Gateway**
- **Удаленное управление замками через Wi-Fi**, используя Gateway.
- Интеграция с API сервера для отправки команд через облако:
    - Открытие/закрытие замка.
    - Проверка состояния (заряд батареи, состояние замка).
- Если Gateway поддерживает, возможна отправка команд напрямую (без TTLock API).
#### 6. **Интеграция с шлюзом на Raspberry Pi**
Если Gateway не поддерживает ваш сервис:
- Сервер отправляет запросы на локальное приложение (например, установленное на Raspberry Pi).
- Приложение преобразует запросы из REST в BLE-команды и отправляет их замку.
- Обратный ответ (успех/ошибка) передается на сервер для обработки.
#### 7. **Безопасность**
- **Шифрование данных**: Для всех запросов между сервером, шлюзом, Raspberry Pi и замком.
- **Аудит безопасности**: Ведение полного журнала операций (кто, когда, что сделал).

---

### Варианты работы с замками
#### Вариант 1: **Через TTLock Gateway**
1. **Принцип работы**:
    - Gateway синхронизируется с замками через BLE.
    - Сервер отправляет команды на Gateway.
    - Gateway получает команды и выполняет действия с замком.
2. **Недостатки**:
    - Потенциальные ограничения по функционалу, если Gateway не поддерживает прямую интеграцию.

#### Вариант 2: **Через локальное приложение (на Raspberry Pi)**
1. **Принцип работы**:
    - Сервер передает REST-запрос на Raspberry Pi.
    - Приложение на Raspberry Pi преобразует запросы в BLE-команды.
    - BLE-команды отправляются замку напрямую.
    - Результат операции возвращается серверу.
2. **Этапы реализации**:
    - Установка приложения на Raspberry Pi:
        - Использование библиотеки **BlueZ** для работы с BLE.
        - Реализация REST API для приема запросов от Java-приложения.
        - Разработка логики формирования BLE-команд (открытие/закрытие, запрос состояния).
    - Сервер отправляет запросы на Raspberry Pi.
    - Raspberry Pi выполняет команды, отправляя их замкам через BLE.
    - Результаты записываются в лог сервера.