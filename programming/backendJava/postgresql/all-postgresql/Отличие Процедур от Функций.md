---
title: Отличие Процедур от Функций
tags:
  - PostgreSql
related_topics: 
created: 2024-10-07 15:53
modified: 2025-04-23T16:53:45+03:00
questions: 
notes: 
links: 
---


В PostgreSQL процедуры и функции имеют различные назначения и отличия в их использовании. Вот основные различия между ними:

### 1. **Назначение**

- **Функции**:
    
    - Предназначены для вычисления и возвращения значения.
    - Используются в SQL-запросах, например, в `SELECT`, `WHERE`, `ORDER BY`, и могут быть вызваны в любом месте запроса.
    - Например, функции могут использоваться для выполнения математических операций, обработки строк или получения данных.
- **Процедуры**:
    
    - Предназначены для выполнения определённой логики, часто связанной с изменением данных или выполнения последовательности операций.
    - Не могут возвращать значения, как функции, но могут возвращать результаты через выходные параметры или просто выполнять действия без необходимости возвращения результата.
    - Используются для выполнения бизнес-логики, манипуляций с данными или управления транзакциями.

### 2. **Сигнатура**

- **Функции**:
    
    - Имеют обязательно указанный тип возвращаемого значения.
    - Можно использовать `RETURNS` для указания типа возвращаемого значения.
    - Пример:

```sql
CREATE FUNCTION my_function() RETURNS INTEGER AS $$
BEGIN
  RETURN 42;
END;
$$ LANGUAGE plpgsql;

```

**Процедуры**:

- Не имеют возвращаемого типа. Используется ключевое слово `CALL` для их вызова.
```sql
CREATE PROCEDURE my_procedure() AS $$
BEGIN
  -- Логика процедуры
END;
$$ LANGUAGE plpgsql;

```

Процедуры в PostgreSQL действительно могут возвращать значения, но это немного отличается от поведения функций. Давай разберём этот момент подробнее:

### **Возвращение значений в функциях**

- **Функции** в PostgreSQL обязательно возвращают значение, и это их основное предназначение.
- Они могут возвращать одно значение или несколько значений (через таблицы, массивы и т. д.).
- Тип возвращаемого значения явно указывается при создании функции через ключевое слово `RETURNS`.

Пример функции:

```sql
CREATE FUNCTION get_sum(a INT, b INT) RETURNS INT AS $$
BEGIN
    RETURN a + b;
END;
$$ LANGUAGE plpgsql;

```

### **Возвращение значений в процедурах**

- **Процедуры** в PostgreSQL **не возвращают значения напрямую** через ключевое слово `RETURN` как функции.
- Однако процедуры могут **возвращать данные** через **выходные параметры**. Это одна из основных особенностей процедур.
- То есть процедура может "возвращать" данные, используя параметры, передаваемые по ссылке. Кроме того, с PostgreSQL 11 появилась возможность **возвращать наборы строк** в процедурах через выходные параметры, но это отличается от возвращения значения в функциях.

Пример процедуры с выходными параметрами:

```sql
CREATE PROCEDURE add_values(IN a INT, IN b INT, OUT sum INT) AS $$
BEGIN
    sum := a + b;
END;
$$ LANGUAGE plpgsql;

```

```sql
CALL add_values(2, 3, sum);
-- sum = 5

```
### **Ключевое различие**

- **Функции** возвращают значения через стандартное `RETURN`, которое можно использовать в SQL-запросах.
- **Процедуры** могут возвращать данные через выходные параметры, что делает их более гибкими для сложной логики (например, для работы с транзакциями), но не позволяет использовать их в SQL-запросах напрямую, как функции.
### **Управление транзакциями**

- **Функции**:
    
    - Не могут управлять транзакциями (например, использовать `COMMIT` или `ROLLBACK` внутри функции).
- **Процедуры**:
    
    - Могут управлять транзакциями, что позволяет им более гибко управлять выполнением логики и изменениями данных.

В PostgreSQL **нет вложенных транзакций**, но есть поддержка `SAVEPOINT`, которая позволяет частично эмулировать поведение вложенных транзакций внутри одной транзакции.










##### Просто пример 
```sql
CREATE FUNCTION add_numbers(a INTEGER, b INTEGER) RETURNS INTEGER AS $$
BEGIN
    RETURN a + b;
END;
$$ LANGUAGE plpgsql;

```

```sql
CREATE PROCEDURE update_salary(emp_id INTEGER, new_salary NUMERIC) AS $$
BEGIN
    UPDATE employees SET salary = new_salary WHERE id = emp_id;
END;
$$ LANGUAGE plpgsql;

```


----
![[Pasted image 20250423165404.png]]
