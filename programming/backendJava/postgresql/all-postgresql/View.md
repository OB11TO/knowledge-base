---
title: View and Coursor
tags:
  - PostgreSql
related_topics: 
created: 2024-09-24 14:19
modified: 2024-11-12T18:40:53+03:00
questions: 
notes: 
links: 
---

----
[[Разные ситуации с VIew]]

-----


### View

`Представление (VIEW)` — <mark class="hltr-yellow">объект базы данных, являющийся результатом выполнения запроса к базе данных, определенного с помощью оператора SELECT, в момент обращения к представлению.</mark> Представления иногда называют "виртуальными таблицам".
Такое название связано с тем, что <mark class="hltr-green2">представление доступно для пользователя как таблица, но само оно не содержит данных, а извлекает их из таблиц в момент обращения к нему.</mark>

`Представления (view`s) – это объекты базы данных, которые всегда создаются на основе одной или более базовых таблиц (или других представлений), используя информацию метаданных. Эта информация (включая имя представления
и способ получения строк из базовых таблиц) – все, что сохраняется физически для представления. Именно по этой причине представления также называют виртуальными таблицами. Если говорить упрощенно, то это SQL-запрос, который можно выполнять, обращаясь к нему по заранее указанному имени.

`Материализованное представление` это <mark class="hltr-yellow">объект базы данных, значением которого является сохраненный результат заранее выполненного запроса, заданного при создании материализованного представления</mark>. Повторное вычисление и сохранение полученного результата происходит согласно правилам, которые определяются при создании материализованного представления.
В упрощенном виде – это SQL-запрос, который можно выполнять, обращаясь к нему по заранее указанному имени, и результат выполнения этого запроса сохраняется для дальнейшего использования.
- Используют индексы
![[images/Untitled 21 3.png|Untitled 21 3.png]]

### Представления (View) и материализованные представления (Materialized View)

**View** и **Materialized View** — это мощные инструменты, которые используются в SQL для представления данных в базах данных. Оба механизма предоставляют виртуальные таблицы, которые могут использоваться для оптимизации запросов, повышения удобства работы с данными и создания уровней абстракции. Однако между ними есть важные различия в том, как и когда они обновляются, хранятся и используются.

### Что такое View?

**View (представление)** — это виртуальная таблица, которая создается на основе SQL-запроса. Представление само по себе не хранит данных, оно динамически отображает данные из одной или нескольких таблиц каждый раз, когда к нему обращаются.

#### Пример создания View:
```sql
CREATE VIEW employee_summary AS
SELECT employee_id, first_name, last_name, department_id, salary
FROM employees
WHERE salary > 5000;
```

В этом примере создается виртуальная таблица `employee_summary`, которая отображает данные сотрудников с зарплатой выше 5000. <mark class="hltr-yellow">Эти данные не хранятся в отдельной таблице, они генерируются каждый раз при обращении к представлению.</mark>
#### Особенности View:

1. **Виртуальность**:
    - Представление не хранит данных. Оно просто сохраняет SQL-запрос и выполняет его каждый раз, когда вы обращаетесь к представлению.
2. **Обновляемость**:
    - Если данные в исходных таблицах изменяются, то изменения автоматически отображаются в представлении. Представление всегда показывает актуальные данные.
3. **Производительность**:
    - Поскольку представление не хранит данные, каждый раз, когда выполняется запрос к представлению, база данных выполняет исходный SQL-запрос. Это может быть медленнее для сложных запросов с множеством соединений и операций.
4. **Безопасность и удобство**:
    - Представления могут использоваться для предоставления уровня абстракции и защиты данных, скрывая сложные запросы и предоставляя доступ только к нужным данным (например, только к важным столбцам).
    - Представления также могут использоваться для объединения нескольких таблиц в одну "логическую" таблицу, упрощая запросы.

#### Когда использовать View:

- Когда нужно скрыть сложные SQL-запросы и предоставить упрощённые представления данных для разработчиков или пользователей.
- Когда нужно создать уровни доступа, предоставляя доступ к данным только через представление (например, скрытие конфиденциальных столбцов).
- Для обеспечения совместимости кода: изменение базовой структуры данных можно скрыть через представление, сохраняя совместимость старых запросов.
- Когда важна актуальность данных, и вы всегда хотите видеть последние изменения в базе данных.

### Что такое Materialized View?

**Materialized View (материализованное представление)** — э<mark class="hltr-yellow">то физическая копия данных, которая создается и сохраняется на диске.</mark> В отличие от обычного представления, материализованное представление хранит результат выполнения запроса в виде таблицы, что может значительно ускорить выполнение повторных запросов.

#### Пример создания Materialized View:
```sql
CREATE MATERIALIZED VIEW employee_sales_summary AS
SELECT e.employee_id, e.first_name, SUM(s.amount) AS total_sales
FROM employees e
JOIN sales s ON e.employee_id = s.employee_id
GROUP BY e.employee_id, e.first_name;
```

Здесь материализованное представление `employee_sales_summary` хранит результат запроса на момент его создания и может обновляться только вручную или по расписанию.

#### Особенности Materialized View:

1. **Физическое хранение данных**:
    
    - Материализованное представление сохраняет результат выполнения запроса в физической таблице. Это означает, что оно может занимать значительное пространство на диске.
2. **Быстродействие**:
    
    - Поскольку данные уже хранятся в материализованном виде, запросы к материализованным представлениям выполняются намного быстрее, чем к обычным представлениям, особенно для сложных операций (агрегаты, джойны и т.д.).
3. **Обновляемость**:
    
    - В отличие от обычных представлений, материализованные представления **не обновляются автоматически** при изменении исходных данных. <mark class="hltr-yellow">Их нужно обновлять вручную с помощью команды</mark> `REFRESH MATERIALIZED VIEW` или автоматически по расписанию.
    - Это может привести к рассинхронизации данных, если материализованное представление долго не обновляется.
4. **Инкрементальное обновление**:
    
    - В некоторых системах баз данных (например, Oracle) материализованные представления могут поддерживать инкрементальное обновление, то есть обновлять только изменённые данные, что позволяет экономить ресурсы.

#### Когда использовать Materialized View:

- Когда у вас сложные и ресурсоёмкие запросы (с многочисленными `JOIN` и агрегатными функциями), и их выполнение занимает слишком много времени.
- Когда данные редко меняются, и вам не нужно всегда показывать самые последние изменения (например, для аналитических отчётов).
- Когда важна производительность запросов, а не немедленная актуальность данных.
- Когда нужно агрегировать большие объёмы данных (например, для отчётов, сводок).
- Когда стоит задача ускорить BI-аналитику и дашборды, где постоянные запросы к основным данным могут замедлить систему.

### Различия между View и Materialized View

|Характеристика|View|Materialized View|
|---|---|---|
|**Хранение данных**|Не хранит данные, только запрос|Хранит данные в виде физической таблицы|
|**Обновляемость**|Автоматически при изменении данных|Обновляется вручную или по расписанию|
|**Производительность**|Медленнее при сложных запросах|Быстрее для сложных запросов|
|**Использование дискового пространства**|Нет, только запрос|Использует диск для хранения данных|
|**Использование ресурсов**|Каждый запрос требует вычислений|Запросы быстрее, но обновление требует ресурсов|
|**Подходит для**|Актуальные данные, динамические отчёты|Статические отчёты, улучшение производительности|

### Лучшие практики использования View и Materialized View

#### Когда лучше использовать View:

- **Для упрощения сложных запросов**: Представления позволяют абстрагировать сложные SQL-запросы и упростить работу с базой данных для разработчиков и пользователей.
- **При необходимости в актуальных данных**: Если вам нужно видеть последние изменения в данных (например, запросы к актуальным транзакциям, инвентаризация), представления всегда будут возвращать актуальные результаты.
- **Для реализации безопасности данных**: Представления можно использовать для предоставления доступа только к нужным столбцам и строкам, скрывая остальные данные.
- **Для обеспечения совместимости**: Представления могут маскировать изменения в схеме базы данных, сохраняя интерфейс старых приложений неизменным.

#### Когда лучше использовать Materialized View:

- **Для ускорения сложных запросов**: Если ваш запрос к базе данных слишком сложный и медленный, материализованное представление может значительно улучшить производительность.
- **Когда данные редко меняются**: Если данные изменяются нечасто (например, в аналитических системах или архивах), материализованные представления идеально подходят.
- **Для агрегированных данных**: В случаях, когда нужно часто обращаться к агрегированным данным (например, суммы, средние значения, группировки), материализованные представления помогают избежать повторных вычислений.
- **Для BI-аналитики и отчетности**: BI-инструменты, которые должны быстро отображать результаты анализа на основе больших объемов данных, часто используют материализованные представления для увеличения скорости работы.

### Нюансы и важные моменты:

1. **Актуальность данных**:
    
    - Обычные представления всегда показывают актуальные данные, но могут быть медленными.
    - Материализованные представления работают быстрее, но данные могут быть устаревшими, если не обновляются своевременно.
2. **Производительность**:
    
    - Представления могут замедлять работу базы данных при сложных запросах с большим количеством соединений, фильтров или операций агрегирования.
    - Материализованные представления помогают избежать этих проблем, но требуют места для хранения данных и периодических обновлений, что также может потребовать ресурсов.
3. **Ручное обновление материализованных представлений**:
    
    - Важно следить за своевременным обновлением материализованных представлений, чтобы данные в них не устаревали. Это можно сделать вручную или с помощью автоматического обновления по расписанию.
4. **Использование индексов**:
    
    - <mark class="hltr-yellow">Материализованные представления поддерживают индексацию, что может значительно ускорить запросы, особенно если в представлении агрегируются данные.</mark>

### Заключение

- **View** — это гибкий и удобный инструмент для абстрагирования сложных запросов и получения актуальных данных. Он не требует хранения данных, но может быть медленным при работе с большими объемами данных или сложными запросами.
- **Materialized View** — это инструмент для оптимизации производительности за счет физического хранения