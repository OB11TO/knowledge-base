---
title: Нормальные формы
tags:
  - PostgreSql
related_topics: 
created: 2024-09-24 14:15
modified: 2025-04-24T18:36:25+03:00
questions: 
notes: 
links: 
---

---
[[UNF без нормализации]]
[[Нормальная форма 1]]
[[Нормальная форма 2]]
[[Нормальная форма 3]]

---

### Нормальные формы

![[images/Untitled 4 8.png|Untitled 4 8.png]]

![[images/Untitled 5 8.png|Untitled 5 8.png]]

![[images/Untitled 6 7.png|Untitled 6 7.png]]

![[images/Untitled 7 7.png|Untitled 7 7.png]]



----

## 1. Что такое денормализация

**Денормализация** — сознательный отказ от некоторых нормальных форм для повышения производительности чтения за счёт введения избыточности данных.

- В нормализованных схемах данные разбиты по таблицам для устранения дублирования и аномалий обновления.
    
- При денормализации несколько связанных таблиц объединяются или дублируются поля, чтобы убрать «тяжёлые» JOIN-ы и ускорить SELECT-запросы [Википедия — свободная энциклопедия](https://ru.wikipedia.org/wiki/%D0%94%D0%B5%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F?utm_source=chatgpt.com).
    

**Ключевой компромисс**:

> - Чтение → быстрее (меньше или нет JOIN’ов)  
>     – Запись/обновление → сложнее (нужно поддерживать консистентность дублированных данных)
>     

---

## 2. Когда имеет смысл рассмотреть денормализацию

1. **Read-heavy нагрузка**
    
    - Если ваша система выполняет тысячи или миллионы SELECT’ов в секунду, а DML-операций мало, и узким местом становятся JOIN-ы [Database Administrators Stack Exchange](https://dba.stackexchange.com/questions/4622/when-should-you-denormalize?utm_source=chatgpt.com).
        
2. **Сложные мульти-JOIN-ы**
    
    - Когда в типичных отчётах или API приходится объединять ≥ 5–6 таблиц, и индексы/шардирование не дают нужного выигрыша [Habr](https://habr.com/ru/articles/64524/?utm_source=chatgpt.com).
        
3. **Отчётность и OLAP-варианты**
    
    - В витринах данных (data warehouse), кубах (cube), materialized views: данные готовятся под конкретные бизнес-отчёты.
        
4. **Исторические снимки (slowly changing dimensions)**
    
    - Нужна «моментальная» картина записи на дату-время, сохраняются значения полей на время создания бизнес-события [Habr](https://habr.com/ru/companies/latera/articles/281262/?utm_source=chatgpt.com).
        
5. **Когда другие методы не помогают**
    
    - Тюнинг индексов, шардинг, кеши (Redis/Memcached), партиционирование, горизонтальное масштабирование не дают SLA по latency.
        

---

## 3. Основные приёмы денормализации

|Приём|Суть|Когда применять|
|---|---|---|
|**Объединение таблиц (table merging)**|Вместо нескольких маленьких таблиц — одна большая.|JOIN’ы частые, таблицы редко обновляются.|
|**Дублирование атрибутов**|Добавление в «факт-таблицу» полей из справочников.|Поля справочников почти не меняются.|
|**Материализованные представления**|Предвычисленные результаты JOIN/агрегаций.|Отчёты, dashboard’ы.|
|**Кэш-таблицы**|Специальные таблицы для горячих запросов.|Чрезмерная нагрузка на основную схему.|
|**Предвычисленные агрегаты**|Хранимые суммы, счётчики, топ-N списки.|Часто запрашиваемая метрика.|

---

## 4. На что смотреть перед принятием решения

1. **Метрики производительности**
    
    - Профилирование запросов (EXPLAIN, slow query log).
        
    - Read/Write ratio (R:W). При R:W > 10:1 обычно оправдано.
        
2. **Варианты оптимизации без денормализации**
    
    - Индексы, покрывающие индексы (covering), шардинг, партиционирование, In-memory OLTP.
        
3. **Стоимость обслуживания (operational cost)**
    
    - Сложность DML-триггеров, синхронизации, увеличенный код репликации.
        
4. **Риск нарушить целостность**
    
    - Вероятность несоответствия дублированных полей; необходимость транзакционной поддержки.
        
5. **Документирование**
    
    - Ясная схема: что и зачем дублируется, какие процедуры обновления.
        

---

## 5. Практика внедрения и поддержки

1. **Пошаговый подход**
    
    1. Оставить основную схему нормализованной.
        
    2. Выделить «горячие» запросы и понять, какие JOIN’ы самые тяжёлые.
        
    3. Спроектировать денорм-таблицы/материализованные представления только под эти кейсы.
        
2. **Механизмы поддержания консистентности**
    
    - Триггеры или stored procedures для DML на исходных таблицах.
        
    - CDC (Change Data Capture) + ETL для витрин.
        
    - CQRS: разделить модели чтения и записи.
        
3. **Мониторинг и алерты**
    
    - Следить за divergence (расхождением) дублированных полей.
        
    - Регулярные проверочные джобы (checksum, row count).
        
4. **Документация и обучение команды**
    
    - Чётко описать, где нормализованная схема, где денормализованная, и почему.
        

---

## 6. Альтернативы и гибридные подходы

- **Кеширование на уровне приложения** (Redis/Memcached)
    
- **Columnar-хранилища** для аналитики (ClickHouse, Amazon Redshift)
    
- **NoSQL-решения** (key-value, document DB) для горизонтальной масштабируемости
    
- **CQRS + Event Sourcing**: отдельные модели для чтения/записи
    

---

## 7. Выводы

- **Не противопоставлять нормализацию и денормализацию** — они дополняют друг друга: сначала чистая нормализованная модель, затем точечная денормализация под узкие места [Otus](https://otus.ru/nest/post/1325/?utm_source=chatgpt.com).
    
- Денормализация оправдана при **очень высокой нагрузке на чтение** и **сложных JOIN-ах**, когда другие методы оптимизации исчерпаны.
    
- Всегда оценивайте **Read/Write ratio**, **сложность поддержки** и **риск рассогласования**.
    
- Документируйте все изменения и внедряйте механизмы синхронизации, чтобы не потерять целостность данных.