---
title: Java NIO-NIO.2 API
tags:
  - IO-NIO
  - Job4j
related_topics: 
created: 2025-01-17 15:24
modified: 2025-01-20T09:52:52+03:00
questions: 
notes: 
links: 
---


![[Pasted image 20250117152552.png]]
<mark class="hltr-blue">IO, NIO и NIO.2 - это не замены друг другу. Скорее они дополняют друг друга для предоставления более широких возможностей работы системы ввода-вывода Java.</mark> В этом разделе мы будем изучать некоторые возможности, которые предоставляют IO и NIO.2, а на уровне Мидл будет продолжение знакомства с NIO.



----

### Что значит "программа блокируется"?

Когда говорят,<mark class="hltr-yellow"> что программа "блокируется", это означает, что выполнение текущего потока программы (не всей программы, а именно активного потока) приостанавливается до завершения определенной операции. </mark><mark class="hltr-green2">Поток не может продолжить выполнение до тех пор, пока операция, например чтение или запись, не будет завершена.</mark>

---

### Пример с блокировкой (IO)

В традиционном IO, если программа выполняет операцию чтения или записи (например, через методы `InputStream.read()` или `OutputStream.write()`), то выполнение программы останавливается до тех пор, пока операция завершится. Это означает, что:

- Если вы читаете данные из файла, программа ждет, пока файл не предоставит данные.
- Если вы получаете данные из сети, программа ждет, пока сервер отправит данные.
- Во время этого ожидания поток программы ничего больше не делает.

Конкретный пример

Допустим, мы читаем данные из файла через `InputStream`:

```java
try (FileInputStream fis = new FileInputStream("example.txt")) {
    int data = fis.read();
    while (data != -1) {
        System.out.print((char) data); // Выводим данные по символу
        data = fis.read(); // Читаем следующий символ
    }
} catch (IOException e) {
    e.printStackTrace();
}
```
 
<mark class="hltr-yellow">Аналог, но через буфер !!!!</mark>

```java
byte[] buffer = new byte[1024];
int bytesRead;
while ((bytesRead = fis.read(buffer)) != -1) {
    System.out.print(new String(buffer, 0, bytesRead));
}

```

- Метод `fis.read()` читает по одному байту из файла.
- Если чтение занимает 1 секунду (например, файл находится на медленном сетевом диске), программа будет ждать эти 1 секунду.
- Поток, который выполняет эту операцию, "блокируется", т.е. он не может выполнять ничего другого, пока чтение не завершится.

---

### Как работает NIO

В Java NIO (New Input/Output) вместо прямого чтения или записи данных используется **буфер**, куда данные загружаются порциями, а поток программы не блокируется, пока данные загружаются.

#### Пример с NIO
```java
try (FileChannel channel = new FileInputStream("example.txt").getChannel()) {
    ByteBuffer buffer = ByteBuffer.allocate(1024); // Создаем буфер на 1024 байта
    while (channel.read(buffer) > 0) { // Читаем данные в буфер
        buffer.flip(); // Подготавливаем буфер для чтения
        while (buffer.hasRemaining()) {
            System.out.print((char) buffer.get()); // Читаем из буфера
        }
        buffer.clear(); // Очищаем буфер для новой загрузки
    }
} catch (IOException e) {
    e.printStackTrace();
}
```

- **Буферизация:** Вместо чтения одного байта за раз, читаются сразу порции данных.
- **Отсутствие блокировки:** Поток может продолжить выполнять другие задачи, пока данные подготавливаются в буфере.

---

### Разница в "блокировке" между IO и NIO

#### В IO:

- Чтение/запись синхронны.
- Поток программы **ждет завершения операции** (блокируется), прежде чем двигаться дальше.

#### В NIO:

- Чтение/запись асинхронны.
- Поток программы может продолжить выполнение других задач, пока данные подготавливаются (например, загружаются в буфер).

---

### Аналогия

Представьте, что вы идете на почту за посылкой:

1. **IO (блокирующий способ):**
    
    - Вы приходите на почту и ждете, пока сотрудник найдет вашу посылку. Всё это время вы не можете делать ничего другого, пока не получите посылку.
2. **NIO (неблокирующий способ):**
    
    - Вы оставляете заявку на посылку и идете заниматься своими делами. Когда посылка будет готова, вам позвонят или отправят уведомление, и вы сможете прийти за ней.

---

