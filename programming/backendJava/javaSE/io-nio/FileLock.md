---
title: FileLock
tags:
  - IO-NIO
related_topics: 
created: 2024-09-10 18:13
modified: 2025-03-24T17:24:50+03:00
questions: 
notes: 
links: 
---

### FileLock

Класс `FileLock` в пакете `java.nio.channels` <mark class="hltr-yellow">представляет собой блокировку файла, которую можно захватить с помощью</mark> `FileChannel`. Эта блокировка и<mark class="hltr-blue">спользуется для предотвращения одновременного доступа к файлу другими каналами и управления доступом к данным в многопоточном или многопроцессном окружении</mark>. Блокировка может быть эксклюзивной (только один канал может захватить блокировку) или разделяемой (несколько каналов могут захватить блокировку одновременно).

#### Основные методы класса `FileLock`:

- **channel()**: Возвращает `FileChannel`, с которым связана эта блокировка. Это позволяет узнать, какой канал захватил блокировку.
    
- **position()**: Возвращает позицию начала блокировки в файле. Это указывает, с какой позиции файла начинается блокировка.
    
- **size()**: Возвращает размер блокировки в байтах. Это показывает, сколько байтов файла заблокировано.
    
- **isShared()**: Возвращает `true`, если блокировка является разделяемой, и `false`, если блокировка является эксклюзивной. Разделяемая блокировка позволяет нескольким каналам читать файл одновременно, но не позволяет никому записывать в него, в то время как эксклюзивная блокировка полностью блокирует доступ к файлу.
    
- **isValid()**: Возвращает `true`, если блокировка действительна, и `false`, если блокировка недействительна. Блокировка может стать недействительной после освобождения или закрытия канала.
    
- **release()**: Освобождает блокировку файла. После вызова этого метода другие каналы могут получить доступ к заблокированной области файла.
    

#### Пример использования `FileLock`:
```java
import java.io.RandomAccessFile;
import java.nio.channels.FileChannel;
import java.nio.channels.FileLock;
import java.io.IOException;

public class FileLockExample {
    public static void main(String[] args) {
        try (RandomAccessFile file = new RandomAccessFile("example.txt", "rw");
             FileChannel channel = file.getChannel()) {

            // Захват эксклюзивной блокировки на весь файл
            FileLock lock = channel.lock();
            System.out.println("File locked: " + lock.isValid());

            // Выполнение операций с файлом
            // ...

            // Освобождение блокировки
            lock.release();
            System.out.println("File lock released.");

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

```

### Описание:

- **`channel()`**: Возвращает `FileChannel`, который использует эту блокировку, позволяя получить доступ к метаданным о файле и операции, связанные с блокировкой.
    
- **`position()`**: Определяет, с какой позиции в файле начинается блокировка. Это важно для понимания, какую часть файла блокирует текущая блокировка.
    
- **`size()`**: Указывает размер блокировки. Это позволяет определить, какой диапазон байтов в файле защищен блокировкой.
    
- **`isShared()`**: Позволяет узнать тип блокировки: эксклюзивная (только один канал имеет доступ) или разделяемая (несколько каналов могут иметь доступ одновременно).
    
- **`isValid()`**: Проверяет, действительна ли блокировка. Это может быть полезно для определения, не истекла ли блокировка после выполнения операций.
    
- **`release()`**: Позволяет освободить блокировку, чтобы другие каналы могли получить доступ к файлу. Это важно для синхронизации и предотвращения конфликта доступа к файлу.
    

### Примечание:

<mark class="hltr-blue">Блокировк</mark> файлов не гарантируют полный механизм взаимного исключения между процессами или потоками. Они предоставляют механизм для управления доступом к файлу, предотвращая <mark class="hltr-yellow">конфликты</mark> между блокирующими и неблокирующими операциями на `FileChannel`. Однако, другие процессы или потоки, которые не используют `FileChannel`, могут все равно получить доступ к файлу.