---
title: –í–∏–¥—ã —Å—Å—ã–ª–æ–∫ job4j
tags:
  - JVM
  - Job4j
related_topics: 
created: 2025-02-04 16:38
modified: 2025-02-05T14:45:40+03:00
questions: 
notes: 
links: 
---


-----
–†–∞–Ω–µ–µ –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –æ —Ç–æ–º, —á—Ç–æ <mark class="hltr-yellow">–ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –º—É—Å–æ—Ä–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –º–∞—Ä–∫–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã</mark>.
<mark class="hltr-green2">–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç—Ç–æ–≥–æ –æ–Ω —Ä–µ—à–∞–µ—Ç –∫–∞–∫–∏–µ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å, –∞ –∫–∞–∫–∏–µ –Ω–µ—Ç.</mark> –ù–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –≤–ª–∏—è–µ—Ç —Ç–∏–ø —Å—Å—ã–ª–∫–∏ –æ–±—ä–µ–∫—Ç–∞.
–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–∏–ø—ã —Å—Å—ã–ª–æ–∫ Java.

---
### **1. Strong Reference**

<mark class="hltr-red">–°–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —è–≤–ª—è–µ—Ç—Å—è "–æ–±—ã—á–Ω–æ–π" —Å—Å—ã–ª–∫–æ–π, –∫–æ—Ç–æ—Ä—É—é –º—ã —Å –≤–∞–º–∏ –ø—Ä–∏–≤—ã–∫–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å</mark>. –ü—Ä–∏ –¥–∞–Ω–Ω–æ–º —Ç–∏–ø–µ —Å—Å—ã–ª–æ–∫ <mark class="hltr-purple">–æ–±—ä–µ–∫—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞ –Ω–∏—Ö –Ω–µ—Ç —Å–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–ª–∏ –æ–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å–æ—Å—Ç–∞–≤–µ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–µ—Ç —Å—Å—ã–ª–∫–∏.</mark>
–ù–∞–ø—Ä–∏–º–µ—Ä,
```java
package ru.job4j.gc.ref;

import java.util.concurrent.TimeUnit;

public class StrongDemo {

    public static void main(String[] args) throws InterruptedException {
        example1();
        /* example2(); */
    }

    private static void example1() throws InterruptedException {
        Object[] objects = new Object[100];
        for (int i = 0; i < 100; i++) {
            objects[i] = new Object() {
                @Override
                protected void finalize() throws Throwable {
                    System.out.println("Object removed!");
                }
            };
        }
        for (int i = 0; i < 100; i++) {
            objects[i] = null;
        }
        System.gc();
        TimeUnit.SECONDS.sleep(5);
    }

    private static void example2() throws InterruptedException {
        Object[] objects = new Object[100];
        for (int i = 0; i < 100; i++) {
            Object object = new Object() {
                Object innerObject = new Object() {
                    @Override
                    protected void finalize() throws Throwable {
                        System.out.println("Remove inner object!");
                    }
                };
            };
            objects[i] = object;
        }
        for (int i = 0; i < 100; i++) {
            objects[i] = null;
        }
        System.gc();
        TimeUnit.SECONDS.sleep(5);
    }
}
```

<mark class="hltr-yellow">–í –ø–µ—Ä–≤–æ–º –º–µ—Ç–æ–¥–µ, –º—ã —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∏ –¥–∞–ª–µ–µ –∏—Ö –∑–∞'null'—è–µ–º. –í—ã–∑—ã–≤–∞–µ–º —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –∏ –∂–¥–µ–º –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è. –û–±—ä–µ–∫—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è, —Ç.–∫. —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∏—Ö null</mark>
<mark class="hltr-purple">–í–æ –≤—Ç–æ—Ä–æ–º –º–µ—Ç–æ–¥–µ, –º—ã —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –≤–º–µ—Å—Ç–µ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏. –£–¥–∞–ª—è—è –≤–Ω–µ—à–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ, –Ω–µ —Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ –æ–Ω–∏ –Ω–µ null.</mark>

<mark class="hltr-red">–ü—Ä–æ–±–ª–µ–º–∞ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Å—Å—ã–ª–æ–∫ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –µ—Å–ª–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –µ—Å—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, —Ç–æ –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —É—Ç–µ—á–∫–µ –ø–∞–º—è—Ç–∏, —á—Ç–æ –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–µ OutOfMemoryException - —Å–∏—Ç—É–∞—Ü–∏–∏ –∫–æ–≥–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏.</mark>

–ö –ø—Ä–∏–º–µ—Ä—É —Ç–∞–∫–æ–π –∫–æ–¥ —è–≤–Ω–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —ç—Ç–æ–π –æ—à–∏–±–∫–µ. –ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –µ–µ —É–≤–∏–¥–µ—Ç—å –º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã -Xmx4m -Xms4m
```java
private static void example3() {
    List<String> strings = new ArrayList<>();
    while (true) {
        strings.add(String.valueOf(System.currentTimeMillis()));
    }
}
```

![[Pasted image 20250204165126.png]]
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏ (WeakReference)** –¥–ª—è –∫–µ—à–µ–π –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –≥–¥–µ –æ–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã GC, –µ—Å–ª–∏ –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.
- **–°–ª–µ–¥–∏—Ç—å –∑–∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ–±—ä–µ–∫—Ç–æ–≤** –∏ –∏–∑–±–µ–≥–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –Ω–∏—Ö.

-----

### **2. Soft Reference**

<mark class="hltr-yellow">–û–±—ä–µ–∫—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è</mark> <mark class="hltr-red">–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Å—ã–ª–∫–∏</mark>, <mark class="hltr-green2">—É–¥–∞–ª—è—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ JVM –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏, —Ç.–µ. –æ–Ω–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∂–∏—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞.</mark>
–î–∞–Ω–Ω—ã–π —Ç–∏–ø —Å—Å—ã–ª–æ–∫<mark class="hltr-purple"> –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—ç—à–∞ - —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è, –∞ –ø–æ—Ç–æ–º —á–∞—Å—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.</mark>
–ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ —Ç—è–∂–µ–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
<mark class="hltr-yellow">–ü—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏ JVM –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –ø–æ —ç—Ç–∏–º —Å—Å—ã–ª–∫–∞–º, –µ—Å–ª–∏ –Ω–∞ –Ω–∏—Ö –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.</mark>

<mark class="hltr-red">–ï—Å—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Å—Å—ã–ª–æ–∫</mark>:<mark class="hltr-green2"> GC –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ —É–¥–∞–ª–∏—Ç –∏–∑ –∫—É—á–∏ –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø–æ soft-—Å—Å—ã–ª–∫–µ, –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –±—Ä–æ—Å–∏—Ç OutOfMemoryError</mark>
```java
package ru.job4j.gc.ref;

import java.lang.ref.SoftReference;
import java.util.ArrayList;
import java.util.List;

public class SoftDemo {

    public static void main(String[] args) {
        /* example1(); */
        example2();
    }

    private static void example1() {
        Object strong = new Object();
        SoftReference<Object> soft = new SoftReference<>(strong);
        strong = null;
        System.out.println(soft.get());
    }

    private static void example2() {
        List<SoftReference<Object>> objects = new ArrayList<>();
        for (int i = 0; i < 100_000_000; i++) {
            objects.add(new SoftReference<Object>(new Object() {
                String value = String.valueOf(System.currentTimeMillis());

                @Override
                protected void finalize() throws Throwable {
                    System.out.println("Object removed!");
                }
            }));
        }
        System.gc();
        int liveObject = 0;
        for (SoftReference<Object> ref : objects) {
            Object object = ref.get();
            if (object != null) {
                liveObject++;
            }
        }
        System.out.println(liveObject);
    }

}
```

<mark class="hltr-red">–í –ø–µ—Ä–≤–æ–º –º–µ—Ç–æ–¥–µ, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –º—ã –∑–∞'null'—É–ª—è–µ–º —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É, –Ω–∞ –æ–±—ä–µ–∫—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å—Å—ã–ª–∫–∞, –∞ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏.</mark>

<mark class="hltr-orange">–í–æ –≤—Ç–æ—Ä–æ–º –º–µ—Ç–æ–¥–µ –º—ã —Å–æ–∑–¥–∞–µ–º –º–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤, –Ω–æ –Ω–∞ –Ω–∏—Ö —Å—Å—ã–ª–∞–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å—Å—ã–ª–∫–∞. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –ø—Ä–∏ –º–∞–ª–æ–º heap –º—ã —É–≤–∏–¥–∏–º, —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã –Ω–∞—á–Ω—É—Ç —É–¥–∞–ª—è—Ç—å—Å—è, —Ç.–∫. –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ö–≤–∞—Ç–∞—Ç—å –ø–∞–º—è—Ç–∏.¬†¬†</mark>

<mark class="hltr-purple">–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —è–≤–ª—è–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–∞–Ω–Ω—ã–µ, –∞ –ø–æ—Ç–æ–º —Ä–∞–±–æ—Ç–∞ —Å —Å–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π.</mark>

<mark class="hltr-green2">–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞—Ö –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π GC –Ω–µ –∑–∞—Ç—Ä–µ—Ç –æ–±—ä–µ–∫—Ç. –≠—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –Ω–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.</mark>

–ü—Ä–∏–º–µ—Ä,
```java
private static void unsafe() {
    List<SoftReference<Object>> someData = new ArrayList<>();
    if (someData.get(0).get() != null) {
        /* do something */
    } else {
        /* do something */
    }
    /* do something */
    someData.get(0).get();
}

private static void safe() {
    List<SoftReference<Object>> someData = new ArrayList<>();
    Object strong = someData.get(0).get();
    if (strong != null) {
        /* do something */
    } else {
        /* do something */
    }
    /* work with strong */
}
```


-----
### **3. Weak Reference**

–û–±—ä–µ–∫—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è<mark class="hltr-red"> —Å–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏</mark>, <mark class="hltr-green2">—É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É, –µ—Å–ª–∏ –Ω–∞ –Ω–∏—Ö –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.</mark>

–î–∞–Ω–Ω—ã–π —Ç–∏–ø —Å—Å—ã–ª–æ–∫ —Å<mark class="hltr-yellow">–ª—É–∂–∏—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —É –æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∏–ø–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—É–ª —Å—Ç—Ä–æ–∫,¬†–∏ –æ–±—ä–µ–∫—Ç—ã —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–≥–æ –æ–¥–∏–Ω —Ä–∞–∑, —Ç.–µ. —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏-–ø–æ–ª—É—á–∏–ª–∏-–∑–∞–±—ã–ª–∏.</mark>

–ü—Ä–∏–º–µ—Ä,
```java
package ru.job4j.gc.ref;

import java.lang.ref.WeakReference;
import java.sql.Time;
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.TimeUnit;

public class WeakDemo {

    public static void main(String[] args) throws InterruptedException {
        /* example1(); */
        example2();
    }

    private static void example1() throws InterruptedException {
        Object object = new Object() {
            @Override
            protected void finalize() throws Throwable {
                System.out.println("Removed");
            }
        };
        WeakReference<Object> weak = new WeakReference<>(object);
        object = null;
        System.gc();
        TimeUnit.SECONDS.sleep(3);
        System.out.println(weak.get());
    }

    private static void example2() throws InterruptedException {
        List<WeakReference<Object>> objects = new ArrayList<>();
        for (int i = 0; i < 100; i++) {
            objects.add(new WeakReference<Object>(new Object() {
                @Override
                protected void finalize() throws Throwable {
                    System.out.println("Removed!");
                }
            }));
        }
        System.gc();
        TimeUnit.SECONDS.sleep(3);
    }

}
```

<mark class="hltr-red">–í –ø–µ—Ä–≤–æ–º –º–µ—Ç–æ–¥–µ –∑–∞'null'–µ–Ω–∏–µ —Å–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É–¥–∞–ª–µ–Ω–∏—é –æ–±—ä–µ–∫—Ç–∞ –∏ –º—ã –µ–≥–æ —Ç–∞–∫–∂–µ —É–∂–µ –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ —Å–ª–∞–±–æ–π —Å—Å—ã–ª–∫–µ.</mark>
<mark class="hltr-orange">–í–æ –≤—Ç–æ—Ä–æ–º –º–µ—Ç–æ–¥–µ –º—ã —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –≤–æ–æ–±—â–µ –±–µ–∑ —Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ –æ–Ω–∏ –≤—Å–µ —É–¥–∞–ª—è—é—Ç—Å—è.</mark>
–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Å—Å—ã–ª–æ–∫ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.


-----

### **ReferenceQueue**

<mark class="hltr-yellow">–í—Å–µ —Ç–∏–ø—ã —Å—Å—ã–ª–æ–∫, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–∏–ª—å–Ω—ã—Ö, –≤ Java —è–≤–ª—è—é—Ç—Å—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞–º–∏ –∫–ª–∞—Å—Å–∞ Reference</mark>. <mark class="hltr-red">–í—Å–µ –µ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç –≤ ReferenceQueue</mark>,¬†<mark class="hltr-green2">—ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —è–≤–Ω–æ (–º—ã –º–æ–∂–µ–º –∑–∞–¥–∞—Ç—å —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å) –∏–ª–∏ –Ω–µ—è–≤–Ω–æ (–∫–æ–≥–¥–∞ –º—ã –Ω–µ –∑–∞–¥–∞–µ–º). –í –Ω–µ–µ –ø–æ–ø–∞–¥–∞—é—Ç —Å—Å—ã–ª–∫–∏ —Ç–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø–æ–º–µ—á–µ–Ω—ã –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ.</mark>

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–æ–∫ WeakReference –∏ PhantomReference (–±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞ –ø–æ–∑–∂–µ) —Å–≤—è–∑–∞–Ω—ã —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –æ—á–µ—Ä–µ–¥–∏ —Å—Å—ã–ª–æ–∫.

<mark class="hltr-orange">–ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ WeakReference, —Ç–∞–∫ —ç—Ç–æ —Ç–æ, —á—Ç–æ, –∫–æ–≥–¥–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç —É–∂–µ –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞'null'–µ–Ω–∏–µ —Å–ª–∞–±–æ–π —Å—Å—ã–ª–∫–∏, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ.</mark>

<mark class="hltr-purple">–î–∞–ª–µ–µ WeakReference –±—É–¥–µ—Ç –ø–æ–º–µ—â–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å ReferenceQueue –∏ –º—ã –º–æ–∂–µ–º, –ø–æ–∫–∞ –æ–±—ä–µ–∫—Ç –Ω–µ —É–¥–∞–ª–µ–Ω —Ñ–∏–∑–∏—á–µ—Å–∫–∏, –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∏–∑ —ç—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏.</mark>

## üîπ **–ß—Ç–æ —Ç–∞–∫–æ–µ `ReferenceQueue`?**

`ReferenceQueue<T>` ‚Äî —ç—Ç–æ **–æ—á–µ—Ä–µ–¥—å —Å—Å—ã–ª–æ–∫**, –≤ –∫–æ—Ç–æ—Ä—É—é –ø–æ–ø–∞–¥–∞—é—Ç **–æ–±—ä–µ–∫—Ç—ã —Å—Å—ã–ª–æ—á–Ω–æ–≥–æ —Ç–∏–ø–∞ (`WeakReference`, `PhantomReference`)**, –∫–æ–≥–¥–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ —Ä–µ—à–∏–ª —É–¥–∞–ª–∏—Ç—å –∏—Ö –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç.

üìå **–í–∞–∂–Ω–æ:** –í `ReferenceQueue` –ø–æ–ø–∞–¥–∞–µ—Ç **—Å–∞–º–∞ —Å–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞**, –∞ –Ω–µ —Å–∞–º –æ–±—ä–µ–∫—Ç.

### üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1Ô∏è‚É£ –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ **–Ω–µ –∏–º–µ–µ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫**, GC —Ä–µ—à–∞–µ—Ç —É–¥–∞–ª–∏—Ç—å –µ–≥–æ.  
2Ô∏è‚É£ –ï—Å–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç –µ—Å—Ç—å **—Ç–æ–ª—å–∫–æ `WeakReference`**, GC:

- –û–±–Ω—É–ª—è–µ—Ç —Å–ª–∞–±—É—é —Å—Å—ã–ª–∫—É (`null`).
- –ö–ª–∞–¥—ë—Ç –µ—ë –≤ `ReferenceQueue`.  
    3Ô∏è‚É£ –ú–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å —Å—Å—ã–ª–∫—É –∏–∑ `ReferenceQueue` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –ø–æ–∫–∞ –æ–±—ä–µ–∫—Ç –µ—â—ë –µ—Å—Ç—å —Ñ–∏–∑–∏—á–∫–∏.

```java
private static void example3() throws InterruptedException {
    Object object = new Object() {
        @Override
        protected void finalize() throws Throwable {
            System.out.println("Removed");
        }
    };
    ReferenceQueue<Object> queue = new ReferenceQueue<>();
    WeakReference<Object> weak = new WeakReference<>(object, queue);
    object = null;

    System.gc();

    TimeUnit.SECONDS.sleep(3);
    System.out.println("from link " + weak.get());
    System.out.println("from queue " + queue.poll());
}
```

![[Pasted image 20250204173040.png]]


```java
import java.lang.ref.ReferenceQueue;
import java.lang.ref.WeakReference;

class Data {
    String value;
    Data(String value) {
        this.value = value;
    }
    @Override
    protected void finalize() {
        System.out.println("üíÄ –û–±—ä–µ–∫—Ç " + value + " —É–¥–∞–ª—ë–Ω");
    }
}

public class WeakReferenceExample {
    public static void main(String[] args) throws InterruptedException {
        ReferenceQueue<Data> queue = new ReferenceQueue<>();
        
        Data data = new Data("–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä! üåç");
        WeakReference<Data> weakRef = new WeakReference<>(data, queue);

        System.out.println("üìå –î–æ —É–¥–∞–ª–µ–Ω–∏—è: " + weakRef.get()); // –í—ã–≤–µ–¥–µ—Ç –æ–±—ä–µ–∫—Ç
        
        data = null; // –£–±–∏—Ä–∞–µ–º —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
        System.gc(); // –í—ã–∑—ã–≤–∞–µ–º —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞

        Thread.sleep(1000); // –î–∞–µ–º GC –≤—Ä–µ–º—è

        System.out.println("üìå –ü–æ—Å–ª–µ GC: " + weakRef.get()); // null, –æ–±—ä–µ–∫—Ç —É–¥–∞–ª—ë–Ω
        
        WeakReference<?> refFromQueue = (WeakReference<?>) queue.poll();
        if (refFromQueue != null) {
            System.out.println("üîÑ –°–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞ –ø–æ–ø–∞–ª–∞ –≤ ReferenceQueue!");
        }
    }
}

```

### üî• **–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?**

1Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç `Data` –∏ —Å–ª–∞–±—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ–≥–æ (`WeakReference`).  
2Ô∏è‚É£ –£–±–∏—Ä–∞–µ–º —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É (`data = null`).  
3Ô∏è‚É£ –í—ã–∑—ã–≤–∞–µ–º `System.gc()` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞.  
4Ô∏è‚É£ GC —É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç `Data`, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞ –Ω–µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ—Ç **—Å–∏–ª—å–Ω—ã—Ö** —Å—Å—ã–ª–æ–∫.  
5Ô∏è‚É£ `WeakReference` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `null`.  
6Ô∏è‚É£ **–°–∞–º–∞ —Å–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞ (`WeakReference`) –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `ReferenceQueue`**.

---

## üîπ **–ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WeakReference`?**

‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** ‚Äî —á—Ç–æ–±—ã –æ–±—ä–µ–∫—Ç—ã –º–æ–≥–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å—Å—è –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏.  
‚úÖ **–ò–∑–±–µ–≥–∞–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏** ‚Äî –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, –Ω–æ –µ–≥–æ —Å—Å—ã–ª–∫–∏ –Ω–µ —É–¥–∞–ª–µ–Ω—ã.  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–æ–≤** ‚Äî –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ReferenceQueue`.

-----

### **4. PhantomReference**

<mark class="hltr-red">–§–∞–Ω—Ç–æ–º–Ω—ã–π —Ç–∏–ø —Å—Å—ã–ª–æ–∫ –∏–º–µ–µ—Ç –¥–≤–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</mark>

1) –ú–µ—Ç–æ–¥<mark class="hltr-orange"> get() –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç—É–ø –º–æ–∂–Ω–æ –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ ReferenceQueue</mark>

2) PhantomReference<mark class="hltr-purple"> –ø–æ–ø–∞–¥–∞–µ—Ç –≤ ReferenceQueue —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è finalize(), —á—Ç–æ –∑–Ω–∞—á–∏—Ç –º—ã –µ—â–µ –∏–º–µ–µ–º –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.</mark>

–î–∞–Ω–Ω—ã–π —Ç–∏–ø —Å—Å—ã–ª–∫–∏ <mark class="hltr-yellow">–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–æ–≤, –º–∏–Ω—É—è –º–∏–Ω—É—Å—ã finalize()</mark> (–±—É–¥—É—Ç –æ–ø–∏—Å–∞–Ω—ã –≤ —Å—Ç–∞—Ç—å–µ –ø–æ –ø–µ—Ä–≤–æ–π —Å—Å—ã–ª–∫–∏)

–ü—Ä–æ–≤–µ–¥–µ–º —Ç–∞–∫–æ–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç:

```java
package ru.job4j.gc.ref;

import java.lang.ref.PhantomReference;
import java.lang.ref.ReferenceQueue;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;
import java.util.ListIterator;
import java.util.concurrent.TimeUnit;

public class PhantomDemo {

    private static class MyPhantom extends PhantomReference<String> {

        private String name;

        public MyPhantom(String referent, ReferenceQueue<? super String> q, String name) {
            super(referent, q);
            this.name = name;
        }

        @Override
        public String get() {
            return name;
        }
    }

    private static class PhantomStorage {

        private ReferenceQueue<String> queue = new ReferenceQueue<>();

        private List<MyPhantom> phantoms = new LinkedList<>();

        public void add(String someData) {
            MyPhantom phantom = new MyPhantom(someData, queue, "my ref");
            phantoms.add(phantom);
        }

        public void utilizeResource() {
            for (ListIterator<MyPhantom> i = phantoms.listIterator(); i.hasNext();) {
                MyPhantom current = i.next();
                if (current != null && current.isEnqueued()) {
                    System.out.println("Utilized " + current.get());
                    current.clear();
                    i.remove();
                }
            }
        }
    }

    public static void main(String[] args) throws InterruptedException {
        PhantomStorage storage = new PhantomStorage();
        String data = "123".repeat(1000);
        storage.add(data);
        data = null;
        System.gc();
        TimeUnit.SECONDS.sleep(3);
        storage.utilizeResource();
    }

}
```

–î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π—Å—è –æ—Ç PhantomReference –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º get(), —á—Ç–æ–±—ã –ø—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è –Ω–∞—à —Ä–µ—Å—É—Ä—Å.¬†

–°–æ–∑–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –í –Ω–µ–º –µ—Å—Ç—å –æ—á–µ—Ä–µ–¥—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è —Å—Å—ã–ª–æ–∫.¬† –ù–æ —ç—Ç–∞ –æ—á–µ—Ä–µ–¥—å read-only, –ø–æ—ç—Ç–æ–º—É —Å–æ–∑–¥–∞–µ–º —Å–≤–æ–π —Å–ø–∏—Å–æ–∫ –∏ –≤ –Ω–µ–≥–æ –ø–æ–º–µ—â–∞–µ–º –Ω–∞—à–∏ —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ —Å—Å—ã–ª–∫–∏. –ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ –¥–ª—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤, –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—Å—ã–ª–∫–∞ –≤ –æ—á–µ—Ä–µ–¥–∏, —Ç.–µ. –ø–æ–º–µ—á–µ–Ω –ª–∏ –æ–±—ä–µ–∫—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ. –î–∞–ª–µ–µ –≤—ã–∑—ã–≤–∞–µ–º¬†—è–≤–Ω–æ¬†–º–µ—Ç–æ–¥ clear(), —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å GC, —á—Ç–æ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç –≤ –±—É–¥—É—â–µ–º –∏ —É–¥–∞–ª—è–µ–º –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞.


------
## üîπ SoftReference üå•Ô∏è

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:

- **SoftReference** –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Å–∏—Å—Ç–µ–º–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤. –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, GC —É–¥–∞–ª—è–µ—Ç —Ç–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

- **–ö—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö** üì∏üíæ  
    _–ü—Ä–∏–º–µ—Ä:_ –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –≥–¥–µ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –∏—Ö –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å, –æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ soft-—Å—Å—ã–ª–∫–∞—Ö. –ü—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏ GC –æ—á–∏—Å—Ç–∏—Ç –∫—ç—à, –æ—Å–≤–æ–±–æ–∂–¥–∞—è —Ä–µ—Å—É—Ä—Å—ã.
- **Memory-sensitive –∫–µ—à–∏** ‚öôÔ∏èüí°  
    _–ü–ª—é—Å:_ –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å OutOfMemoryError, —Ç–∞–∫ –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏.

---

## üîπ WeakReference üï∏Ô∏è

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:

- **WeakReference** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–∏—Ö –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è **—Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫**.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

- **WeakHashMap** üìöüóëÔ∏è  
    _–ü—Ä–∏–º–µ—Ä:_ –í `WeakHashMap` –∫–ª—é—á–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è weak-—Å—Å—ã–ª–∫–∞–º–∏. –ï—Å–ª–∏ –Ω–∞ –∫–ª—é—á –±–æ–ª—å—à–µ –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏.
- **–ü–∞—Ç—Ç–µ—Ä–Ω "–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å" (Observer)** üëÄüîî  
    _–ü—Ä–∏–º–µ—Ä:_ –ü—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π. –ï—Å–ª–∏ —Å–ª—É—à–∞—Ç–µ–ª—å –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, weak-—Å—Å—ã–ª–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç GC —É–¥–∞–ª–∏—Ç—å –µ–≥–æ, –Ω–µ —Ç—Ä–µ–±—É—è —è–≤–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–º –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º** ‚è≥üí®  
    _–ü–ª—é—Å:_ –û–±—ä–µ–∫—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–º—è—Ç—å—é.

---

## üîπ PhantomReference üëª

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:

- **PhantomReference** ‚Äì —Å–∞–º—ã–π ¬´—Ç–æ–Ω–∫–∏–π¬ª —Ç–∏–ø —Å—Å—ã–ª–∫–∏. –ú–µ—Ç–æ–¥ `get()` –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null`, –∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è **–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–æ–º–µ–Ω—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞**.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏** üíªüîß  
    _–ü—Ä–∏–º–µ—Ä:_ –ö–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç —Å–≤—è–∑–∞–Ω —Å –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä—è–º—ã–º–∏ –±—É—Ñ–µ—Ä–∞–º–∏, —Ñ–∞–π–ª–∞–º–∏ –∏–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö). –§–∞–Ω—Ç–æ–º–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—é —ç—Ç–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ä–µ–∫—Ç –±—ã–ª —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω GC.
- **–ù–∞–¥—ë–∂–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–µ–∑ finalize()** üßπüöÄ  
    _–ü—Ä–∏–º–µ—Ä:_ –í–º–µ—Å—Ç–æ –º–µ—Ç–æ–¥–∞ `finalize()`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç —Å–≤–æ–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PhantomReference –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å `ReferenceQueue` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å—Ç–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º.
- **Cleaner API –≤ Java 9+** üßº‚ú®  
    _–ü—Ä–∏–º–µ—Ä:_ –ù–æ–≤—ã–π API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ö–æ–∂–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–æ–π —Ä–µ—Å—É—Ä—Å–æ–≤, –¥–µ–ª–∞—è –ø—Ä–æ—Ü–µ—Å—Å –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–º –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–Ω—Ç–æ–º–Ω–æ–π —Å—Å—ã–ª–∫–∏:**  
    –§–∞–Ω—Ç–æ–º–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ `ReferenceQueue` üéØ.
2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞:**  
    –ö–æ–≥–¥–∞ GC —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è PhantomReference –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å üïí.
3. **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:**  
    –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è PhantomReference –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, –∑–Ω–∞—è, —á—Ç–æ –æ–±—ä–µ–∫—Ç —É–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª —Å–≤–æ—ë "–∂–∏–∑–Ω–µ–Ω–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ" üåå.

---

## üîπ –ò—Ç–æ–≥–æ–≤—ã–π –æ–±–∑–æ—Ä –∫–µ–π—Å–æ–≤ üöÄ

- **SoftReference** üå•Ô∏è  
    _–ö–µ–π—Å:_ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π) –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –µ—Å–ª–∏ –ø–∞–º—è—Ç—å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è.
    
- **WeakReference** üï∏Ô∏è  
    _–ö–µ–π—Å:_ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `WeakHashMap` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–ª—é—á–µ–π –∏–ª–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π –≤ Observer-–ø–∞—Ç—Ç–µ—Ä–Ω–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏.
    
- **PhantomReference** üëª  
    _–ö–µ–π—Å:_ –ù–∞–¥—ë–∂–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å—Ç–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.


----

üìå **–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ `i`?**

- –ï—Å–ª–∏ `i` ‚Äî **—ç–∫–∑–µ–º–ø–ª—è—Ä–Ω–æ–µ –ø–æ–ª–µ** (`private Integer i;`), —Ç–æ **—Å—Å—ã–ª–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫—É—á–µ –≤–Ω—É—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–∞**.
- –ï—Å–ª–∏ `i` ‚Äî **–ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è** (`Integer i = 10;` –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞), —Ç–æ **—Å—Å—ã–ª–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å—Ç–µ–∫–µ**.
- –ï—Å–ª–∏ `i` ‚Äî **`static` –ø–æ–ª–µ**, —Ç–æ **—Å—Å—ã–ª–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ MetaSpace (–∏–ª–∏ PermGen –≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Java)**, –∞ –æ–±—ä–µ–∫—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –∫—É—á–µ