---
title: Структуры данных в java, где можно хранить null
tags:
  - Collection
related_topics: 
created: 2024-09-09 17:47
modified: 2024-09-10T12:22:27+03:00
difficulty: 
questions: 
notes: 
links: 
---
### Структуры данных, где можно хранить `null`

1. **`ArrayList`**:
    
    - Можно хранить `null`.
    - Это динамический массив, и он не имеет ограничений на хранение `null` значений.
2. **`LinkedList`**:
    
    - Можно хранить `null`.
    - Это двусвязный список, и он позволяет хранить любые значения, включая `null`.
3. **`HashSet`**:
    
    - Можно хранить **<mark class="hltr-red">один</mark>** `null`.
    - `HashSet` использует хеширование для хранения элементов, и в этом контексте `null` интерпретируется как отдельный элемент с отсутствующим хеш-кодом. Поскольку это множество, допускается не более одного `null`.
4. **`HashMap`**:
    
    - Можно хранить <mark class="hltr-red">**один**</mark> `null` в качестве **ключа** и неограниченное количество `null` в качестве **значений**.
    - Внутренняя реализация `HashMap` допускает `null` как ключ, поскольку этот случай обрабатывается отдельной логикой в методах, таких как `get()`, `put()`, и `containsKey()`.
5. **`WeakHashMap`**:
    
    - Можно хранить **один** `null` в качестве **ключа** и неограниченное количество `null` в качестве **значений**.
    - Аналогично `HashMap`, в `WeakHashMap` допускается хранение `null`.
6. **`IdentityHashMap`**:
    
    - Можно хранить **один** `null` в качестве **ключа** и неограниченное количество `null` в качестве **значений**.
    - Работает по принципу сравнения ключей через оператор `==`, но допускает `null` как ключ.
7. **`ConcurrentHashMap` (для значений)**:
    
    - Можно хранить **`null`** в качестве **значений** т<mark class="hltr-green2">олько в старых версиях (до Java 8)</mark>. <mark class="hltr-red">В новых версиях </mark>`null` <mark class="hltr-red">в качестве значений не поддерживается, потому что это может приводить к неопределенному поведению при работе в многопоточной среде.</mark>
8. **`PriorityQueue`** (в некоторых реализациях):
    
    - Можно хранить `null` <mark class="hltr-yellow">в некоторых старых реализациях, однако это может быть небезопасно для работы с очередями при упорядочивании.</mark>

---

### Структуры данных, где **нельзя** хранить `null`

1. **`TreeSet`**:
    
    - Нельзя хранить `null`.
    - `TreeSet` <mark class="hltr-yellow">использует механизм сравнения</mark> (либо через `Comparable`, либо через `Comparator`). Поскольку `null` <mark class="hltr-green2">не имеет естественного порядка</mark>, попытка вставить `null` приведет к `NullPointerException`.
2. **`TreeMap`**:
    
    - Нельзя хранить `null` в качестве **ключа**.
    - Как и `TreeSet`, `TreeMap` использует сортировку ключей, что делает невозможным хранение `null` в качестве ключа, так как это нарушает логику сравнения ключей.
    - Однако <mark class="hltr-yellow">в качестве </mark>**значения** `null` <mark class="hltr-green2">допустим</mark>.
3. **`ConcurrentHashMap`**:
    
    - Нельзя хранить **`null`** <mark class="hltr-green2">ни в качестве **ключа**, ни в качестве **значения**.</mark>
    - В многопоточных средах, таких как `ConcurrentHashMap`, наличие `null` м<mark class="hltr-yellow">ожет привести к потенциальным ошибкам и сбоям во время выполнения (например, невозможно однозначно интерпретировать, отсутствует ли значение или ключ</mark>, или оно `null`). Поэтому такие структуры запрещают использование `null`.
4. **`EnumSet`**:
    
    - Нельзя хранить `null`.
    - `EnumSet` предназначен для хранения только перечислений (`enum`), и поэтому не допускает `null` значения, так как `null` не является допустимым элементом перечисления.
5. **`EnumMap`**:
    
    - Нельзя хранить `null` в качестве **ключа**.
    - Ключи в `EnumMap` должны быть значениями из перечисления, и `null` не может быть частью перечисления.
    - Однако в качестве **значений** `null` допустим.

---

### Причины, по которым нельзя хранить `null` в некоторых структурах данных:

1. **Проблемы с сортировкой и сравнением**:
    
    - В коллекциях, использующих сравнение или сортировку (например, `TreeSet`, `TreeMap`), `null` не имеет естественного порядка, и попытка сравнить его с другими объектами вызывает `NullPointerException`.
2. **Проблемы с многопоточностью**:
    
    - В многопоточных структурах данных (например, `ConcurrentHashMap`) наличие `null` может привести к двусмысленности: как интерпретировать отсутствие элемента — как отсутствующий ключ или как `null` значение. Это усложняет алгоритмы синхронизации и может привести к ошибкам.
3. **Оптимизация работы с памятью**:
    
    - В некоторых коллекциях (например, `EnumSet`) предусмотрены оптимизации, основанные на работе с конкретными типами данных (такими как `enum`), где хранение `null` не только нецелесообразно, но и нарушает логику работы коллекции.

### Вывод
![[Pasted image 20240910122217.png]]
- **Можно хранить `null`** в таких коллекциях, как `ArrayList`, `LinkedList`, `HashSet`, и `HashMap`, так как они не предъявляют особых требований к данным.
- **Нельзя хранить `null`** в коллекциях, использующих механизм сравнения (`TreeSet`, `TreeMap`), а также в многопоточных структурах (`ConcurrentHashMap`), чтобы избежать неопределенности и исключений в процессе работы.